<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Form</title>
    <style>
        body {
            background-color: rgb(30, 30, 30);
            color:tan;
        }
        input, textarea {
            background-color: #222;   /* or rgb(30,30,30) for consistency */
            color: tan;
            border: 1px solid tan;
            padding: 5px;
        }
        input::placeholder, textarea::placeholder {
            color: #bfa76a; /* lighter tan for placeholder */
            opacity: 1;
        }
    </style>
</head>
<body>
    <textarea id="textInput" placeholder="Enter your text here" rows="4" cols="50"></textarea>
    <button onclick="sendData()">Send</button>
    
    <br><br>
    
    <textarea id="consoleHistory" readonly rows="10" cols="50" placeholder="Console history will appear here..."></textarea>
    <br>
    <button onclick="fetchHistory()">Refresh History</button>
    <button onclick="resetConsole()">Reset Console</button>

    <script>
        const BASE_URL = 'http://192.168.1.4:8321';
        // Ngrok:https://2ea6-2601-644-8f00-230-00-d0.ngrok-free.app
        // Local:http://192.168.1.4:8321
        
        function sendData() {
            const input = document.getElementById('textInput');
            const text = input.value;
            
            // Convert text to base64 (matching new server strategy)
            const encoder = new TextEncoder();
            const utf8Bytes = encoder.encode(text);
            const base64String = btoa(String.fromCharCode(...utf8Bytes));
            const base64Bytes = new TextEncoder().encode(base64String);
            
            fetch(`${BASE_URL}/console_push`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/octet-stream'
                },
                body: base64Bytes
            })
            .then(response => response.arrayBuffer())
            .then(buffer => {
                // Decode base64 response back to text
                const decoder = new TextDecoder('utf-8');
                const base64Response = decoder.decode(buffer);
                const responseText = atob(base64Response);
                console.log('Success:', responseText);
                console.log('Data sent successfully!');
            })
            .catch(error => {
                console.error('Error:', error);
                console.log('Error sending data');
            });
        }
        
        function fetchHistory() {
            fetch(`${BASE_URL}/console_history_string`, {
                headers: {
                    'ngrok-skip-browser-warning': 'true'
                }
            })
            .then(response => response.arrayBuffer())
            .then(buffer => {
                // Decode base64 response back to text (matching new server strategy)
                const decoder = new TextDecoder('utf-8');
                const base64Response = decoder.decode(buffer);
                const text = atob(base64Response);
                
                // Display in textarea
                document.getElementById('consoleHistory').value = text;
            })
            .catch(error => {
                console.error('Error fetching history:', error);
                alert('Error fetching console history');
            });
        }
        
        function resetConsole() {
            fetch(`${BASE_URL}/reset_console`, {
                method: 'POST'
            })
            .then(() => {
                console.log('Console reset');
            })
            .catch(error => {
                console.error('Error resetting console:', error);
            });
        }
    </script>
</body>
</html>