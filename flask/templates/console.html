<!DOCTYPE html>
<html>
<head>
    <title>Python Console</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        h1 {
            margin-bottom: 20px;
            color: #ffffff;
        }
        #console-container {
            border: 1px solid #444;
            border-radius: 4px;
            padding: 10px;
            background-color: #1a1a1a;
            height: 400px;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        .console-line {
            margin: 0;
            white-space: pre-wrap;
            line-height: 1.5;
            color: #ffffff;
        }
        .command-prompt {
            color: #ff00ff;
            font-weight: bold;
        }
        .command {
            color: #ffffff;
            font-weight: bold;
        }
        .input-area {
            display: flex;
            margin-bottom: 10px;
        }
        #codeline {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #444;
            border-radius: 4px;
            font-family: monospace;
            background-color: #000000;
            color: #ffffff;
        }
        #codeline::placeholder {
            color: #aaaaaa;
        }
        button {
            margin-left: 10px;
            padding: 8px 16px;
            background-color: #ff00ff;
            color: #000000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background-color: #cc00cc;
        }
        #reset-button {
            background-color: #d93030;
        }
        #reset-button:hover {
            background-color: #b32525;
        }
    </style>
</head>
<body>
    <h1>Python Interactive Console</h1>
    
    <div id="console-container">
        {% for line in historyarr %}
            {% if line.startswith('>>> ') %}
                <p class="console-line command"><span class="command-prompt">>>> </span>{{ line[4:] }}</p>
            {% else %}
                <p class="console-line">{{ line }}</p>
            {% endif %}
        {% endfor %}
    </div>

    <form id="code-form" action="/codeline" method="POST">
        <div class="input-area">
            <input type="text" id="codeline" name="codeline" autocomplete="off" placeholder="Enter Python code here..." required>
            <button type="submit">Run</button>
        </div>
    </form>
    
    <form action="/resetconsole" method="GET">
        <button id="reset-button" type="submit">Reset Console</button>
    </form>

    <script>
        // Scroll to bottom of console on page load
        document.addEventListener('DOMContentLoaded', function() {
            const consoleContainer = document.getElementById('console-container');
            consoleContainer.scrollTop = consoleContainer.scrollHeight;
            
            // Focus on input field
            document.getElementById('codeline').focus();
            
            // Handle form submission without page refresh
            const codeForm = document.getElementById('code-form');
            codeForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                
                fetch('/codeline', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.text())
                .then(html => {
                    // Extract just the console content from the response
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const newConsoleContent = doc.getElementById('console-container').innerHTML;
                    
                    // Update just the console content
                    document.getElementById('console-container').innerHTML = newConsoleContent;
                    
                    // Scroll to bottom
                    consoleContainer.scrollTop = consoleContainer.scrollHeight;
                    
                    // Clear and focus the input field
                    document.getElementById('codeline').value = '';
                    document.getElementById('codeline').focus();
                });
            });
        });
    </script>
</body>
</html>